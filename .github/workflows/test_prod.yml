name: test –∫–æ–¥–∞ –Ω–∞ avto-as.ru

env:
  VPS_IP: 46.254.19.97
  VPS_USERNAME: di4basa7
  DIR: www/lara2
  DIR_PROD: www/prod
  GIT_BRANCH: origin/main
  GIT_BRANCH_PROD: origin/prod

on:
  schedule:
    - cron: "37 08 * * *"
  workflow_dispatch:
# inputs:
#   deployment_target:
#     description: Choose target
#     required: true
# default: second_test
# type: 
# options:
#   - —Ç–µ—Å—Ç –±–æ–µ–≤–æ–≥–æ —Å–∞–π—Ç–∞
#   - —Ç–µ—Å—Ç —Å–∞–π—Ç–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

jobs:

  test:
    runs-on: ubuntu-latest
    steps:

      - name: —Ç–µ—Å—Ç –±–æ–µ–≤–æ–≥–æ —Å–∞–π—Ç–∞
        uses: appleboy/ssh-action@master
        with:
          host: ${{ env.VPS_IP }}
          username: ${{ env.VPS_USERNAME }}
          key: ${{ secrets.DEPLOY_KEY }}
          script: |
            cd ${{ env.DIR_PROD }}
            /opt/php74/bin/php artisan test

  sms_start:

    runs-on: ubuntu-latest
    steps:

      - name: send telega
        uses: appleboy/telegram-action@master
        with:
          # to: ${{ secrets.TELEGRAM_TO }}
          # —è / –ê–≤—Ç–æ-–ê–° / –î–µ–Ω–∏—Å –ê–≤—Ç–æ-–°–ê
          to: 360209578, 1022228978, 663501687 
          token: ${{ secrets.TELEGRAM_TOKEN }}
          message: |
            üê•üê•üê• —Å—Ç–∞—Ä—Ç —Ç–µ—Å—Ç–∞ –∫–æ–¥–∞ avto-as.ru
            (${{ github.run_id }})

  sms_end:
    runs-on: ubuntu-latest
    needs: test
    steps:
      - name: send telega
        uses: appleboy/telegram-action@master
        with:
          # to: ${{ secrets.TELEGRAM_TO }}
          # —è / –ê–≤—Ç–æ-–ê–° / –î–µ–Ω–∏—Å –ê–≤—Ç–æ-–°–ê
          to: 360209578, 1022228978, 663501687 
          token: ${{ secrets.TELEGRAM_TOKEN }}
          message: |
            üçÄüçÄüçÄ –¢–µ—Å—Ç –ø—Ä–æ–≤–µ–¥—ë–Ω —É—Å–ø–µ—à–Ω–æ
            ${{ github.run_id }}
